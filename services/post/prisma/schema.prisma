// npx prisma migrate dev --name init
// This prisma migrate dev command generates SQL files and directly runs them against the database.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("LIFTHUS_POST_DB_URL")
}

model Post {
  id        BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  author    BigInt     @db.UnsignedBigInt
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  content   String     @db.Text
  mentions  Mention[]  @relation("mentions")
  likes     PostLike[]
  comments  Comment[]
}

model Comment {
  id        BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  author    BigInt   @db.UnsignedBigInt
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  post      Post     @relation(fields: [postId], references: [id])
  postId    BigInt   @db.UnsignedBigInt
  content   String   @db.VarChar(531)

  parent   Comment? @relation("replies", fields: [parentId], references: [id])
  parentId BigInt?  @db.UnsignedBigInt

  mentions Mention[]     @relation("mentions")
  likes    CommentLike[]
  replies  Comment[]     @relation("replies")
}

model PostLike {
  id        BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  post      Post     @relation(fields: [postId], references: [id])
  postId    BigInt   @db.UnsignedBigInt
  user      BigInt   @db.UnsignedBigInt
  createdAt DateTime @default(now())
}

model CommentLike {
  id        BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  comment   Comment  @relation(fields: [postId], references: [id])
  postId    BigInt   @db.UnsignedBigInt
  user      BigInt   @db.UnsignedBigInt
  createdAt DateTime @default(now())
}

model Mention {
  id BigInt @id @default(autoincrement()) @db.UnsignedBigInt

  post     Post?    @relation("mentions", fields: [postId], references: [id])
  postId   BigInt?  @db.UnsignedBigInt
  coment   Comment? @relation("mentions", fields: [comentId], references: [id])
  comentId BigInt?  @db.UnsignedBigInt

  mentionor BigInt @db.UnsignedBigInt
  mentionee BigInt @db.UnsignedBigInt
}
